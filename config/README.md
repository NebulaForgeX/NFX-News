# 配置文件说明

本目录包含 TrendRadar 项目的配置文件。

## 文件列表

- `config.yaml` - 主配置文件（平台、推送模式、通知设置等）
- `frequency_words.txt` - 关键词配置文件（监控的关键词和分类规则）

---

## frequency_words.txt 格式规则

### 📋 基础语法类型

| 语法类型 | 符号 | 作用 | 示例 | 匹配逻辑 |
|---------|------|------|------|---------|
| **普通词** | 无 | 基础匹配 | `华为` | 标题包含任意一个即可 |
| **必须词** | `+` | 限定范围 | `+手机` | 必须同时包含普通词和必须词 |
| **过滤词** | `!` | 排除干扰 | `!广告` | 包含则直接排除 |
| **数量限制** | `@` | 控制显示数量 | `@10` | 最多显示10条新闻 |

### 1. 普通词（无前缀）

```txt
华为
鸿蒙
特斯拉
```

**作用：** 新闻标题包含其中**任意一个词**就会被捕获

**匹配逻辑：** OR 逻辑（任一匹配即可）

**示例：**
- ✅ "华为发布新系统" → 匹配
- ✅ "特斯拉股价上涨" → 匹配
- ❌ "苹果发布新iPhone" → 不匹配

---

### 2. 必须词（`+` 前缀）

```txt
华为
OPPO
+发布
```

**作用：** 必须同时包含普通词**和**必须词才会被捕获

**匹配逻辑：** AND 逻辑（普通词 AND 必须词）

**示例：**
- ✅ "华为发布新手机" → 匹配（有"华为"和"发布"）
- ✅ "OPPO发布Find X7" → 匹配（有"OPPO"和"发布"）
- ❌ "华为销量增长" → 不匹配（有"华为"但无"发布"）

---

### 3. 过滤词（`!` 前缀）

```txt
特斯拉
马斯克
!车
!餐
```

**作用：** 包含过滤词的新闻会被**直接排除**，即使包含关键词

**优先级：** 最高（即使匹配关键词也会被排除）

**示例：**
- ✅ "特斯拉股价上涨" → 匹配
- ❌ "特斯拉汽车降价" → 被排除（包含"车"）
- ❌ "特斯拉餐厅开业" → 被排除（包含"餐"）

---

### 4. 数量限制（`@` 前缀）

```txt
特斯拉
马斯克
@5
```

**作用：** 限制该关键词组最多显示的新闻条数

**格式：** `@数字`（必须是正整数）

**优先级：** `@数字` > 全局配置 > 不限制

**说明：** 按权重排序后，只显示前 N 条

---

### 🔗 分组规则（空行分隔）

**核心规则：** 用**空行**（`\n\n`）分隔不同的词组，每个词组独立统计和显示

```txt
胖东来
于东来
                    ← 空行，第1组结束

DeepSeek
梁文锋
                    ← 空行，第2组结束

华为
鸿蒙
HarmonyOS
任正非
                    ← 空行，第3组结束
```

**规则说明：**
- 每个组形成一个独立的分类
- 组名（`group_key`）由普通词用空格连接生成
- 新闻按顺序匹配，匹配到第一个符合条件的组就归入该组
- **一个新闻只会归入一个组**（匹配到第一个就停止）

---

### 📝 完整示例

```txt
# 第1组：手机发布（限制10条）
iPhone
华为
OPPO
+发布
@10

# 第2组：股市波动（排除预测类）
A股
上证
深证
+涨跌
!预测

# 第3组：特斯拉（排除汽车和餐厅相关）
特斯拉
马斯克
!车
!餐
@5
```

---

### 🔄 匹配逻辑流程

对于每个新闻标题，系统按以下流程处理：

1. **检查过滤词**
   - 如果标题包含任何 `!` 词 → 直接排除，不进行后续匹配

2. **遍历所有词组**（按文件中的顺序从上到下）
   - 检查必须词：如果有 `+` 词，标题必须包含**所有**必须词
   - 检查普通词：如果有普通词，标题至少包含**一个**普通词
   - 匹配成功 → 归入该组，**停止匹配**（`break`）

3. **如果都不匹配**
   - 不分类（除非配置了"全部新闻"模式）

---

### ⚠️ 注意事项

1. **空行分隔**：必须用空行分隔不同组，否则会被视为同一组
2. **匹配顺序**：按文件中的顺序从上到下匹配
3. **一个新闻只归入一个组**：匹配到第一个符合条件的组就停止
4. **大小写不敏感**：匹配时转换为小写比较
5. **过滤词优先级最高**：即使匹配关键词，包含过滤词也会被排除
6. **数量限制优先级**：`@数字` > `config.yaml` 的 `max_news_per_keyword` > 不限制

---

### 🎯 特殊规则

- **如果 `frequency_words.txt` 为空**：显示所有新闻（除非有全局过滤）
- **如果只有一个组且组名为"全部新闻"**：所有标题都归入该组
- **组名生成规则**：
  - 优先使用普通词（用空格连接）
  - 如果没有普通词，则使用必须词（用空格连接）

---

### 💡 使用建议

1. **合理分组**：将相关的关键词放在同一组，用空行分隔不同主题
2. **使用必须词**：当关键词太宽泛时，用 `+` 限定范围
3. **使用过滤词**：排除不相关的干扰信息
4. **设置数量限制**：对于热门话题，用 `@数字` 限制显示数量，避免信息过载
5. **测试匹配**：修改后运行一次，查看匹配效果，再调整

---

## config.yaml 配置说明

详见 `config.yaml` 文件内的注释说明。

主要配置项：
- `platforms` - 监控的平台列表
- `report.mode` - 报告模式（daily/incremental/current）
- `report.max_news_per_keyword` - 每个关键词最大显示数量（全局）
- `notification` - 通知相关配置

